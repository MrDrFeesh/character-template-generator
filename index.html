<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Character Template Generator</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <style>
    html, body { height: 100%; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body class="min-h-full bg-stone-50 text-stone-900">
  <div id="root"></div>

  <!-- Babel (so we can use JSX in the browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    function Section({ title, children, aside }) {
      return (
        <section className="bg-white rounded-2xl shadow-sm border border-stone-200 p-5 md:p-6">
          <div className="flex items-start justify-between gap-4 mb-4">
            <h2 className="text-xl font-semibold text-stone-800">{title}</h2>
            {aside}
          </div>
          <div className="grid gap-4">{children}</div>
        </section>
      );
    }

    function L({ label, children, help }) {
      return (
        <label className="grid gap-1">
          <span className="text-sm font-medium text-stone-700">{label}</span>
          {children}
          {help && <span className="text-xs text-stone-500">{help}</span>}
        </label>
      );
    }

    const defaultStats = {
      health: 5000,
      stamina: 100,
      staminaGain: 21,
      staminaDrain: 9.5,
      walkspeed: 8,
      sprintspeed: 28,
    };

    const abilityLabels = ["Q", "E", "R", "T"]; // order mapping

    function App() {
      const [name, setName] = useState("");
      const [quote, setQuote] = useState("");
      const [role, setRole] = useState("Survivor"); // Survivor | Killer
      const [survivorType, setSurvivorType] = useState("Sustain");
      const [killerStyle, setKillerStyle] = useState("Rushdown");
      const [cost, setCost] = useState(0);
      const [description, setDescription] = useState("");
      const [difficulty, setDifficulty] = useState(3); // 1..5
      const [stats, setStats] = useState(defaultStats);

      const [hasPassive, setHasPassive] = useState(false);
      const [passiveName, setPassiveName] = useState("");
      const [passiveDesc, setPassiveDesc] = useState("");

      const [m1Name, setM1Name] = useState("");
      const [m1CD, setM1CD] = useState(2);
      const [m1Desc, setM1Desc] = useState("");

      const [abilityCount, setAbilityCount] = useState(1); // 1..4
      const [abilities, setAbilities] = useState([
        { key: "Q", name: "", cd: "", desc: "" },
        { key: "E", name: "", cd: "", desc: "" },
        { key: "R", name: "", cd: "", desc: "" },
        { key: "T", name: "", cd: "", desc: "" },
      ]);

      const [hasStatuses, setHasStatuses] = useState(false);
      const [statusCount, setStatusCount] = useState(1);
      const [statuses, setStatuses] = useState([
        { name: "", desc: "" },
      ]);

      // LocalStorage persistence
      useEffect(() => {
        const saved = localStorage.getItem("ctg_state_v1");
        if (saved) {
          try {
            const data = JSON.parse(saved);
            setName(data.name || "");
            setQuote(data.quote || "");
            setRole(data.role || "Survivor");
            setSurvivorType(data.survivorType || "Sustain");
            setKillerStyle(data.killerStyle || "Rushdown");
            setCost(data.cost ?? 0);
            setDescription(data.description || "");
            setDifficulty(data.difficulty || 3);
            setStats({ ...defaultStats, ...(data.stats || {}) });
            setHasPassive(Boolean(data.hasPassive));
            setPassiveName(data.passiveName || "");
            setPassiveDesc(data.passiveDesc || "");
            setM1Name(data.m1Name || "");
            setM1CD(data.m1CD ?? 2);
            setM1Desc(data.m1Desc || "");
            setAbilityCount(data.abilityCount || 1);
            setAbilities(
              (data.abilities && data.abilities.length)
                ? abilityLabels.map((k, i) => data.abilities[i] || { key: k, name: "", cd: "", desc: "" })
                : abilityLabels.map((k) => ({ key: k, name: "", cd: "", desc: "" }))
            );
            setHasStatuses(Boolean(data.hasStatuses));
            setStatusCount(data.statusCount || 1);
            setStatuses(
              (data.statuses && data.statuses.length)
                ? data.statuses
                : [{ name: "", desc: "" }]
            );
          } catch {}
        }
      }, []);

      useEffect(() => {
        const payload = {
          name, quote, role, survivorType, killerStyle, cost, description, difficulty, stats,
          hasPassive, passiveName, passiveDesc,
          m1Name, m1CD, m1Desc,
          abilityCount, abilities,
          hasStatuses, statusCount, statuses,
        };
        localStorage.setItem("ctg_state_v1", JSON.stringify(payload));
      }, [name, quote, role, survivorType, killerStyle, cost, description, difficulty, stats, hasPassive, passiveName, passiveDesc, m1Name, m1CD, m1Desc, abilityCount, abilities, hasStatuses, statusCount, statuses]);

      const stars = useMemo(() => "★★★★★".slice(0, Math.max(1, Math.min(5, Number(difficulty) || 1)))
        + "☆☆☆☆☆".slice(0, 5 - Math.max(1, Math.min(5, Number(difficulty) || 1))), [difficulty]);

      const trimmedAbilities = useMemo(() => abilities.slice(0, abilityCount), [abilities, abilityCount]);

      // Ensure statuses array length matches statusCount when enabled
      useEffect(() => {
        if (!hasStatuses) return;
        setStatuses(prev => {
          const next = [...prev];
          if (statusCount > next.length) {
            for (let i = next.length; i < statusCount; i++) next.push({ name: "", desc: "" });
          } else if (statusCount < next.length) {
            next.length = statusCount;
          }
          return next;
        });
      }, [hasStatuses, statusCount]);

      const output = useMemo(() => {
        const lines = [];
        const nl = (s="") => lines.push(s);

        nl(name || "Name");
        nl(quote ? `‘${quote}’` : "‘Purchase quote’");
        nl(`Cost: ${cost || 0}$`);
        if (role === "Survivor") {
          nl(`Type (Survivors): ${survivorType || "Sustain (survival) / Stunner (stuns/slows killer) / Support (helps team, but weak on their own)"}`);
        } else {
          nl(`Playstyle (Killers): ${killerStyle || "Rushdown (kill shit fast) / Ranged (uses projectiles mostly) / Trapper (relies on environment to pick people off) / Wildcard (idfk)"}`);
        }
        nl("");
        nl(description || "Description");
        nl("");
        nl(`Difficulty - ${stars}`);
        nl(`Health - ${stats.health}`);
        nl(`Stamina - ${stats.stamina}`);
        nl(`Stamina gain per second - ${stats.staminaGain}`);
        nl(`Stamina drain per second - ${stats.staminaDrain}`);
        nl(`Walkspeed - ${stats.walkspeed}`);
        nl(`Runspeed - ${stats.sprintspeed}`);
        nl("");
        nl("Passives");
        if (hasPassive) {
          nl(passiveName || "Name");
          nl(passiveDesc || "What the thing does");
        } else {
          nl("None");
        }
        nl("");
        nl("Abilities");
        if (role === "Killer") {
          nl(`M1 - ${m1Name || "Name"} (for killers)`);
          nl(`CD - ${m1CD || 2}s`);
          nl(m1Desc || "What the thing does");
          nl("");
        }
        trimmedAbilities.forEach((a, idx) => {
          const key = abilityLabels[idx];
          nl(`${key} - ${a.name || "Name"}`);
          nl(`CD - ${a.cd !== "" ? a.cd : "#"}s`);
          nl(a.desc || "What the thing does");
          nl("");
        });
        if (hasStatuses) {
          nl("Status Effects");
          statuses.forEach((s) => {
            nl(`${s.name || "Name"}`);
            nl(`${s.desc || "Description of status effect"}`);
          });
        }
        return lines.join("\n");
      }, [name, quote, cost, role, survivorType, killerStyle, description, stars, stats, hasPassive, passiveName, passiveDesc, m1Name, m1CD, m1Desc, trimmedAbilities, hasStatuses, statuses]);

      function updateStat(key, value) {
        setStats(prev => ({ ...prev, [key]: value }));
      }

      function handleAbilityChange(index, field, value) {
        setAbilities(prev => prev.map((a, i) => i === index ? { ...a, [field]: value } : a));
      }

      function copyToClipboard() {
        navigator.clipboard.writeText(output).then(() => {
          alert("Template copied to clipboard!");
        }).catch(() => alert("Copy failed (browser permissions)."));
      }

      function downloadTxt() {
        const blob = new Blob([output], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${name || 'character'}-template.txt`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      function resetAll() {
        if (!confirm("Clear all fields?")) return;
        setName(""); setQuote(""); setRole("Survivor"); setSurvivorType("Sustain"); setKillerStyle("Rushdown");
        setCost(0); setDescription(""); setDifficulty(3); setStats(defaultStats);
        setHasPassive(false); setPassiveName(""); setPassiveDesc("");
        setM1Name(""); setM1CD(2); setM1Desc("");
        setAbilityCount(1);
        setAbilities(abilityLabels.map((k) => ({ key: k, name: "", cd: "", desc: "" })));
        setHasStatuses(false); setStatusCount(1); setStatuses([{ name: "", desc: "" }]);
        localStorage.removeItem("ctg_state_v1");
      }

      return (
        <div className="max-w-6xl mx-auto px-4 py-8 md:py-10">
          <header className="mb-8">
            <h1 className="text-3xl md:text-4xl font-bold tracking-tight">Character Template Generator</h1>
            <p className="text-stone-600 mt-2">Fill out the form. Get a copy‑pasteable template that matches your format exactly.</p>
          </header>

          <div className="grid gap-6">
            <Section title="Basics" aside={<button onClick={resetAll} className="text-sm text-stone-600 hover:text-stone-900 underline">Reset</button>}>
              <div className="grid md:grid-cols-2 gap-4">
                <L label="Character Name">
                  <input className="border rounded-lg px-3 py-2" value={name} onChange={e=>setName(e.target.value)} placeholder="e.g., The Priest" />
                </L>
                <L label="Purchase Quote">
                  <input className="border rounded-lg px-3 py-2" value={quote} onChange={e=>setQuote(e.target.value)} placeholder="e.g., 'Faith is a blade sharper than steel.'" />
                </L>
                <L label="Cost ($)">
                  <input type="number" min="0" className="border rounded-lg px-3 py-2" value={cost} onChange={e=>setCost(Number(e.target.value))} />
                </L>
                <L label="Role">
                  <select className="border rounded-lg px-3 py-2" value={role} onChange={e=>setRole(e.target.value)}>
                    <option>Survivor</option>
                    <option>Killer</option>
                  </select>
                </L>
                {role === 'Survivor' && (
                  <L label="Survivor Type" help="Examples: Sustain, Stunner, Support">
                    <input className="border rounded-lg px-3 py-2" value={survivorType} onChange={e=>setSurvivorType(e.target.value)} placeholder="Sustain / Stunner / Support" />
                  </L>
                )}
                {role === 'Killer' && (
                  <L label="Killer Playstyle" help="Examples: Rushdown, Ranged, Trapper, Wildcard">
                    <input className="border rounded-lg px-3 py-2" value={killerStyle} onChange={e=>setKillerStyle(e.target.value)} placeholder="Rushdown / Ranged / Trapper / Wildcard" />
                  </L>
                )}
              </div>
            </Section>

            <Section title="Description & Difficulty">
              <L label="Description">
                <textarea className="border rounded-lg px-3 py-2 min-h-[120px]" value={description} onChange={e=>setDescription(e.target.value)} placeholder="Brief description" />
              </L>
              <div className="flex items-center gap-4">
                <L label={`Difficulty (${difficulty} star${difficulty==1?'':'s'})`}>
                  <input type="range" min="1" max="5" value={difficulty} onChange={e=>setDifficulty(Number(e.target.value))} />
                </L>
                <div className="text-2xl" aria-label="difficulty stars">{"★".repeat(difficulty)}{"☆".repeat(5 - difficulty)}</div>
              </div>
            </Section>

            <Section title="Core Stats (with defaults)">
              <div className="grid md:grid-cols-3 gap-4">
                <L label="Health (default 5000)">
                  <input type="number" className="border rounded-lg px-3 py-2" value={stats.health} onChange={e=>updateStat('health', Number(e.target.value))} />
                </L>
                <L label="Stamina (default 100)">
                  <input type="number" className="border rounded-lg px-3 py-2" value={stats.stamina} onChange={e=>updateStat('stamina', Number(e.target.value))} />
                </L>
                <L label="Stamina gain/sec (default 21)">
                  <input type="number" step="0.1" className="border rounded-lg px-3 py-2" value={stats.staminaGain} onChange={e=>updateStat('staminaGain', Number(e.target.value))} />
                </L>
                <L label="Stamina drain/sec (default 9.5)">
                  <input type="number" step="0.1" className="border rounded-lg px-3 py-2" value={stats.staminaDrain} onChange={e=>updateStat('staminaDrain', Number(e.target.value))} />
                </L>
                <L label="Walkspeed (default 8)">
                  <input type="number" step="0.1" className="border rounded-lg px-3 py-2" value={stats.walkspeed} onChange={e=>updateStat('walkspeed', Number(e.target.value))} />
                </L>
                <L label="Sprint speed (default 28)">
                  <input type="number" step="0.1" className="border rounded-lg px-3 py-2" value={stats.sprintspeed} onChange={e=>updateStat('sprintspeed', Number(e.target.value))} />
                </L>
              </div>
            </Section>

            <Section title="Passive (optional)">
              <div className="flex items-center gap-3">
                <input id="hasPassive" type="checkbox" className="h-4 w-4" checked={hasPassive} onChange={e=>setHasPassive(e.target.checked)} />
                <label htmlFor="hasPassive" className="text-sm">This character has a passive</label>
              </div>
              {hasPassive && (
                <div className="grid md:grid-cols-2 gap-4">
                  <L label="Passive Name"><input className="border rounded-lg px-3 py-2" value={passiveName} onChange={e=>setPassiveName(e.target.value)} /></L>
                  <L label="Passive Description"><input className="border rounded-lg px-3 py-2" value={passiveDesc} onChange={e=>setPassiveDesc(e.target.value)} /></L>
                </div>
              )}
            </Section>

            {role === 'Killer' && (
              <Section title="M1 Attack (Killers)">
                <div className="grid md:grid-cols-3 gap-4">
                  <L label="M1 Name"><input className="border rounded-lg px-3 py-2" value={m1Name} onChange={e=>setM1Name(e.target.value)} /></L>
                  <L label="Cooldown (s)" help="Default 2s">
                    <input type="number" step="0.1" className="border rounded-lg px-3 py-2" value={m1CD} onChange={e=>setM1CD(Number(e.target.value))} />
                  </L>
                  <L label="Description"><input className="border rounded-lg px-3 py-2" value={m1Desc} onChange={e=>setM1Desc(e.target.value)} /></L>
                </div>
              </Section>
            )}

            <Section title="Abilities (Q, E, R, T)">
              <L label="How many abilities?">
                <select className="border rounded-lg px-3 py-2 w-40" value={abilityCount} onChange={e=>setAbilityCount(Number(e.target.value))}>
                  <option value={1}>1</option>
                  <option value={2}>2</option>
                  <option value={3}>3</option>
                  <option value={4}>4</option>
                </select>
              </L>
              <div className="grid gap-4">
                {abilities.slice(0, abilityCount).map((a, i) => (
                  <div key={i} className="rounded-xl border border-stone-200 p-4">
                    <h3 className="font-semibold mb-3">{abilityLabels[i]} Ability</h3>
                    <div className="grid md:grid-cols-3 gap-4">
                      <L label="Name"><input className="border rounded-lg px-3 py-2" value={a.name} onChange={e=>handleAbilityChange(i, 'name', e.target.value)} /></L>
                      <L label="Cooldown (s)"><input type="number" step="0.1" className="border rounded-lg px-3 py-2" value={a.cd} onChange={e=>handleAbilityChange(i, 'cd', e.target.value)} /></L>
                      <L label="Description"><input className="border rounded-lg px-3 py-2" value={a.desc} onChange={e=>handleAbilityChange(i, 'desc', e.target.value)} /></L>
                    </div>
                  </div>
                ))}
              </div>
            </Section>

            <Section title="Status Effects (optional)">
              <div className="flex items-center gap-3">
                <input id="hasStatuses" type="checkbox" className="h-4 w-4" checked={hasStatuses} onChange={e=>setHasStatuses(e.target.checked)} />
                <label htmlFor="hasStatuses" className="text-sm">This character applies special status effects</label>
              </div>
              {hasStatuses && (
                <>
                  <L label="How many status effects?">
                    <select className="border rounded-lg px-3 py-2 w-40" value={statusCount} onChange={e=>setStatusCount(Number(e.target.value))}>
                      {[1,2,3,4,5].map(n => <option key={n} value={n}>{n}</option>)}
                    </select>
                  </L>
                  <div className="grid gap-4">
                    {statuses.map((s, i) => (
                      <div key={i} className="rounded-xl border border-stone-200 p-4">
                        <h3 className="font-semibold mb-3">Status Effect {i+1}</h3>
                        <div className="grid md:grid-cols-2 gap-4">
                          <L label="Name"><input className="border rounded-lg px-3 py-2" value={s.name} onChange={e=>setStatuses(prev => prev.map((x, idx) => idx===i?{...x, name:e.target.value}:x))} /></L>
                          <L label="Description"><input className="border rounded-lg px-3 py-2" value={s.desc} onChange={e=>setStatuses(prev => prev.map((x, idx) => idx===i?{...x, desc:e.target.value}:x))} /></L>
                        </div>
                      </div>
                    ))}
                  </div>
                </>
              )}
            </Section>

            <Section title="Generated Template">
              <div className="flex flex-wrap gap-3 mb-2">
                <button onClick={copyToClipboard} className="px-4 py-2 rounded-lg bg-stone-900 text-white hover:opacity-90">Copy</button>
                <button onClick={downloadTxt} className="px-4 py-2 rounded-lg border border-stone-300 hover:bg-stone-100">Download .txt</button>
              </div>
              <pre className="mono whitespace-pre-wrap bg-stone-900 text-stone-100 rounded-xl p-4 overflow-auto max-h-[50vh]">{output}</pre>
            </Section>

            <footer className="text-xs text-stone-500 mt-4">All data is stored locally in your browser (localStorage). Single-file app — drop into any repo or host on GitHub Pages/Vercel.</footer>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
